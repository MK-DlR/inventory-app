<!-- views/search-results.ejs -->

<!DOCTYPE html>
<html lang="en">
  <%- include("./partials/head.ejs") %>
  <body>
    <div class="search-results content">
      <h1><%= title %></h1>
      <%- include("./partials/filter.ejs") %>
      <%- include("./partials/sort.ejs") %>

      <!-- check if BOTH arrays are empty -->
      <% if (searchResults.plants.length === 0 && searchResults.medicinal_uses.length === 0) { %>
        <p>No results found for "<%= searchTerm %>".</p>
      <% } else { %>
        <!-- plants section -->
        <% if (searchResults.plants.length > 0) { %>
          <h2>Plants (<%= searchResults.plants.length %>)</h2>
          <div id="plant-list" class="plant-list">
            <% searchResults.plants.forEach(plant => { %>
              <div class="plant-card"
                   data-common="<%= plant.common_name %>" 
                   data-scientific="<%= plant.scientific_name %>"
                   data-quantity="<%= quantityToSortValue(plant.quantity_level) %>"
                   data-created="<%= plant.created_at %>"
                   data-updated="<%= plant.updated_at %>">
                <a href="/plants/<%- plant.id %>" class="card-link">
                  <img src="<%= plant.image_url %>" class="card-img">
                  <p class="plant-name">
                    <strong class="common-name"><%= plant.common_name %></strong><br>
                    <em class="scientific-name"><%= plant.scientific_name %></em>
                  </p>
                  <div class="plant-status">
                    <div class="stock badge">
                      <i class="fa-solid fa-leaf"></i> <%= formatStockStatus(plant.stock_status) %>
                    </div>

                    <% if (plant.quantity_level) { %>
                      <div class="quantity badge">
                        <i class="fa-solid fa-ranking-star"></i> <%= formatQuantityLevel(plant.quantity_level) %>
                      </div>
                    <% } %>

                    <% if (plant.order_status) { %>
                      <div class="order badge">
                        <i class="fa-solid fa-box-archive"></i> <%= formatStockStatus(plant.order_status) %>
                      </div>
                    <% } %>
                  </div>
                </a>
              </div>
            <% }) %>
          </div>
        <% } %>

        <!-- medicinal uses section -->
        <% if (searchResults.medicinal_uses.length > 0) { %>
          <h2>Medicinal Uses (<%= searchResults.medicinal_uses.length %>)</h2>
          <ul class="stacked-list">
            <% searchResults.medicinal_uses.forEach(use => { %>
              <li class="list-item">
                <a href="/medicinal/<%= use.id %>" class="list-link">
                  <div class="list-content">
                    <div class="list-main">
                      <p class="list-title"><%= use.use_name %></p>
                    </div>
                  </div>
                  <svg class="chevron-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                  </svg>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } %>
      <% } %>
    </div>

    <script src="/dropdown.js"></script>
    <script src="/sort.js"></script>
  </body>
</html>