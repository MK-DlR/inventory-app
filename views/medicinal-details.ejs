<!-- views/medicinal-details.ejs -->

<!DOCTYPE html>
<html lang="en">
  <%- include("./partials/head.ejs") %>
  <body>
    <div class="medicinal-details content">
      <h1 class="medicinal-name"><%= medicinalUse.use_name %></h1>

      <!-- display validation errors -->
        <% if (locals.errors && errors.length > 0) { %>
          <div class="error-messages" style="color: red; background: #ffe6e6; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
            <strong>Please fix the following errors:</strong>
            <ul>
              <% errors.forEach(error => { %>
                <% 
                  // Check if error message contains medicinal ID separator
                  const [message, medicinalId] = error.msg.split('||'); 
                %>
                <li>
                  <%= message %>
                    <% if (medicinalId) { %>
                      <a href="/medicinal/<%= medicinalUse.id %>" style="color: #0066cc; text-decoration: underline;">View existing medicinal use</a>
                    <% } %>
                </li>
              <% }) %>
            </ul>
            </div>
          <% } %>

        <div class="description-section">
          <div class="medicinal-info">
            <% if (medicinalUse.description) { %>
              <p><%= medicinalUse.description %></p>
            <% } else { %>
              <p>No description available.</p>
            <% } %>
            <div class="control-buttons">
              <button onclick="window.location.href='/medicinal/<%= medicinalUse.id %>/edit';" class="button control-medicinal">Edit</button>
              <form action="/medicinal/<%- medicinalUse.id %>/delete" method="POST" onsubmit="return confirm('Are you sure to want to delete this medicinal use?');">
                <button type="submit" class="button control-medicinal">Delete</button>
              </form>
            </div>
          </div>
        </div>

      <% if (plants && plants.length > 0) { %>
        <div id="plant-list" class="plant-list">
          <% plants.forEach(plant => { %>
            <%- include("./partials/plant-card.ejs", { 
              plant: plant,
              quantityToSortValue: quantityToSortValue,
              formatStockStatus: formatStockStatus,
              formatQuantityLevel: formatQuantityLevel
            }) %>
          <% }) %>
        </div>
      <% } else { %>
        <ul>No plants associated with this use.</ul>
      <% } %>
    </div>  
  </body>
</html>