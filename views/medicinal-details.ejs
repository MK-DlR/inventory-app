<!-- views/medicinal-details.ejs -->

<!DOCTYPE html>
<html lang="en">
  <%- include("./partials/head.ejs") %>
<body>
  <div class="medicinal-details content">
    <h1><%= medicinalUse.use_name %></h1>

    <!-- display validation errors -->
      <% if (locals.errors && errors.length > 0) { %>
        <div class="error-messages" style="color: red; background: #ffe6e6; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
          <strong>Please fix the following errors:</strong>
          <ul>
            <% errors.forEach(error => { %>
              <% 
                // Check if error message contains medicinal ID separator
                const [message, medicinalId] = error.msg.split('||'); 
              %>
              <li>
                <%= message %>
                  <% if (medicinalId) { %>
                    <a href="/medicinal/<%= medicinalUse.id %>" style="color: #0066cc; text-decoration: underline;">View existing medicinal use</a>
                  <% } %>
              </li>
            <% }) %>
          </ul>
          </div>
        <% } %>

    
    <ul>
      <strong>Description</strong>
      <% if (medicinalUse.description) { %>
      <p><%= medicinalUse.description %></p>
      <% } else { %>
      <p>No description available.</p>
      <% } %>
      <div class="control-buttons">
        <button onclick="window.location.href='/medicinal/<%= medicinalUse.id %>/edit';">Edit</button>
        <form action="/medicinal/<%- medicinalUse.id %>/delete" method="POST" onsubmit="return confirm('Are you sure to want to delete this medicinal use?');">
          <button type="submit">Delete</button>
        </form>
      </div>
    </ul>
    
    <h2>Plants:</h2>
    <% if (plants && plants.length > 0) { %>
      <ul>
        <% plants.forEach(plant => { %>
          <li><a href="/plants/<%- plant.id %>"><%= plant.common_name %> (<em><%= plant.scientific_name %></em>)</a></li>
        <% }) %>
      </ul>
    <% } else { %>
      <ul>No plants associated with this use.</ul>
    <% } %>
  </div>

  <%- include("./partials/footer.ejs") %>
  
</body>

</html>